{
  "evaluation_config": {
    "name": "Milestone 6: Comprehensive Metrics & Evaluation Protocol",
    "version": "1.0.0",
    "description": "Production-ready evaluation framework for Lethe agent-context manager",
    
    "reproducibility": {
      "random_seed": 42,
      "deterministic": true,
      "tolerance_percent": 2.0,
      "hardware_standardization": true
    },
    
    "datasets": {
      "primary": "LetheBench-Agents",
      "splits": ["train", "dev", "test"],
      "corpus_sizes": [1000, 10000, 100000],
      "quick_test_size": 100
    },
    
    "baselines": {
      "required": [
        "bm25_only",
        "vector_only", 
        "hybrid_static",
        "mmr_diversity",
        "doc2query_expansion",
        "crossencoder_rerank"
      ],
      "reference_baseline": "bm25_only"
    },
    
    "metrics": {
      "ir_metrics": {
        "primary": ["ndcg_10", "ndcg_20", "recall_10", "recall_20", "mrr_10"],
        "k_values": [10, 20],
        "per_scenario": true,
        "overall": true
      },
      
      "agent_metrics": {
        "tool_result_recall": {
          "k_values": [5, 10, 20],
          "required": true
        },
        "action_argument_consistency": {
          "method": "heuristic_overlap",
          "threshold": 0.5
        },
        "loop_exit_rate": {
          "detection_method": "pattern_based",
          "loop_indicators": ["error", "failed", "retry", "timeout", "stuck"]
        },
        "provenance_precision": {
          "session_coherence": true,
          "cross_session_leakage_detection": true
        }
      },
      
      "efficiency_metrics": {
        "latency": {
          "percentiles": [50, 95, 99],
          "cold_warm_comparison": true,
          "per_stage_timing": true
        },
        "memory": {
          "peak_measurement": true,
          "index_size": true
        },
        "concurrency": {
          "client_levels": [1, 5, 10],
          "qps_measurement": true
        }
      }
    },
    
    "statistical_testing": {
      "framework": "comprehensive",
      "tests": {
        "wilcoxon": {
          "enabled": true,
          "paired": true,
          "alternative": "two-sided"
        },
        "bootstrap": {
          "enabled": true,
          "n_samples": 1000,
          "method": "bca",
          "confidence_level": 0.95
        }
      },
      "multiple_comparisons": {
        "correction": "bonferroni",
        "family_wise_error_rate": 0.05
      },
      "effect_size": {
        "cohens_d": true,
        "interpretation": ["negligible", "small", "medium", "large"],
        "thresholds": [0.2, 0.5, 0.8]
      }
    },
    
    "hardware_profiles": {
      "supported": [
        "Linux_x86_64",
        "Darwin_arm64", 
        "Darwin_x86_64",
        "Windows_AMD64"
      ],
      "standardized_measurements": true,
      "resource_monitoring": true
    },
    
    "output": {
      "main_file": "metrics.json",
      "detailed_files": [
        "ir_metrics_detailed.json",
        "agent_metrics_detailed.json", 
        "efficiency_metrics_detailed.json",
        "statistical_tests_detailed.json"
      ],
      "csv_exports": [
        "ir_metrics.csv",
        "agent_metrics.csv",
        "statistical_tests.csv"
      ],
      "plots": [
        "overall_performance_comparison.png",
        "scenario_performance_breakdown.png", 
        "agent_metrics_comparison.png",
        "efficiency_scaling.png",
        "statistical_significance_heatmap.png"
      ],
      "directory_structure": "./results/{hardware_profile}/",
      "timestamp": true
    },
    
    "quality_gates": {
      "reproducibility_tolerance": 0.02,
      "minimum_queries": 50,
      "minimum_baselines": 4,
      "statistical_power_threshold": 0.8,
      "coverage_requirements": {
        "scenarios": 3,
        "corpus_sizes": 2,
        "concurrency_levels": 2
      }
    },
    
    "performance_targets": {
      "evaluation_time_limit_minutes": 60,
      "memory_limit_gb": 16,
      "disk_space_requirement_gb": 5,
      "parallel_workers": 4
    }
  },
  
  "baseline_specific_config": {
    "bm25_only": {
      "k1": 1.2,
      "b": 0.75,
      "db_path": ":memory:",
      "porter_stemming": true
    },
    
    "vector_only": {
      "model_name": "all-MiniLM-L6-v2",
      "index_type": "hnsw",
      "ef_construction": 200,
      "ef_search": 50,
      "dimension": 384,
      "normalize_embeddings": true
    },
    
    "hybrid_static": {
      "alpha": 0.5,
      "normalization": "minmax",
      "fusion_method": "linear"
    },
    
    "mmr_diversity": {
      "lambda": 0.7,
      "candidate_pool_multiplier": 5,
      "diversity_objective": "entity_based"
    },
    
    "doc2query_expansion": {
      "num_expansions": 3,
      "expansion_model": "doc2query/msmarco-t5-base-v1", 
      "fallback_method": "pattern_based",
      "cache_expansions": true
    },
    
    "crossencoder_rerank": {
      "rerank_model": "cross-encoder/ms-marco-MiniLM-L-2-v2",
      "rerank_k": 100,
      "batch_size": 32,
      "base_retriever": "vector_only"
    }
  },
  
  "experimental_settings": {
    "ablation_studies": false,
    "hyperparameter_sweeps": false,
    "cross_validation": false,
    "ensemble_methods": false
  },
  
  "logging": {
    "level": "INFO",
    "file": "milestone6_evaluation.log",
    "console": true,
    "detailed_timing": true,
    "resource_monitoring": true
  }
}